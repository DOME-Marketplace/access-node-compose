services:

  # --- TMForum APIs ---
  # These services provide the standard TMForum Open APIs for DOME.

  account:
    # Service: TMF666 - Account Management
    # Purpose: Manages user accounts and profiles.
    # Internal Ports: 8080 (API), 9090 (Admin/Metrics)
    image: docker.io/drllbl18/tmforum-account:sbx_1.5.2
    container_name: account
    restart: always
    labels:
      - "dome.name=account"
      - "dome.description=Manages user accounts and profiles"
      - "dome.owner=Libelium"
      - "dome.type=service"
      - "dome.lifecycle=sandbox"
      - "dome.dependsOn=component:scorpio"
      - "dome.versions="
    # ports:
    #   - "8080:8080"
    #   - "9090:9090"
    env_file:
      - .env.tmforum-common
    networks:
      - access-node

  agreement:
    # Service: TMF651 - Agreement Management
    # Purpose: Manages commercial and technical agreements.
    # Internal Ports: 8080 (API), 9090 (Admin/Metrics)
    image: docker.io/drllbl18/tmforum-agreement:sbx_1.5.2
    container_name: agreement
    restart: always
    labels:
      - "dome.name=agreement"
      - "dome.description=Manages agreements"
      - "dome.owner=Libelium"
      - "dome.type=service"
      - "dome.lifecycle=sandbox"
      - "dome.dependsOn=component:scorpio"
      - "dome.versions="
    # ports:
    #   - "8080:8080"
    #   - "9090:9090"
    env_file:
      - .env.tmforum-common
    networks:
      - access-node


  customer-bill-management:
    # Service: TMF678 - Customer Bill Management
    # Purpose: Handles invoicing and billing information.
    # Internal Ports: 8080 (API), 9090 (Admin/Metrics)
    image: docker.io/drllbl18/tmforum-customer-bill-management:sbx_1.5.2
    container_name: customer-bill-management
    restart: always
    labels:
      - "dome.name=customer-bill-management"
      - "dome.description=Handles customer billing"
      - "dome.owner=Libelium"
      - "dome.type=service"
      - "dome.lifecycle=sandbox"
      - "dome.dependsOn=component:scorpio"
      - "dome.versions="
    # ports:
    #   - "8080:8080"
    #   - "9090:9090"
    env_file:
      - .env.tmforum-common
    networks:
      - access-node


  customer-management:
    # Service: TMF629 - Customer Management
    # Purpose: Manages customer information and lifecycle.
    # Internal Ports: 8080 (API), 9090 (Admin/Metrics)
    image: docker.io/drllbl18/tmforum-customer-management:sbx_1.5.2
    container_name: customer-management
    restart: always
    labels:
      - "dome.name=customer-management"
      - "dome.description=Manages customer profiles"
      - "dome.owner=Libelium"
      - "dome.type=service"
      - "dome.lifecycle=sandbox"
      - "dome.dependsOn=component:scorpio"
      - "dome.versions="
    # ports:
    #   - "8080:8080"
    #   - "9090:9090"
    env_file:
      - .env.tmforum-common
    networks:
      - access-node


  party-catalog:
    # Service: TMF632 - Party Management
    # Purpose: Repository for parties (organizations/individuals).
    # Internal Ports: 8080 (API), 9090 (Admin/Metrics)
    image: docker.io/drllbl18/tmforum-party-catalog:sbx_1.5.2
    container_name: party-catalog
    restart: always
    labels:
      - "dome.name=party-catalog"
      - "dome.description=Catalog of parties"
      - "dome.owner=Libelium"
      - "dome.type=service"
      - "dome.lifecycle=sandbox"
      - "dome.dependsOn=component:scorpio"
      - "dome.versions="
    # ports:
    #   - "8080:8080"
    #   - "9090:9090"
    env_file:
      - .env.tmforum-common
    networks:
      - access-node


  party-role:
    # Service: TMF669 - Party Role Management
    # Purpose: Manages the roles played by parties.
    # Internal Ports: 8080 (API), 9090 (Admin/Metrics)
    image: docker.io/drllbl18/tmforum-party-role:sbx_1.5.2
    container_name: party-role
    restart: always
    labels:
      - "dome.name=party-role"
      - "dome.description=Manages party roles"
      - "dome.owner=Libelium"
      - "dome.type=service"
      - "dome.lifecycle=sandbox"
      - "dome.dependsOn=component:scorpio"
      - "dome.versions="
    # ports:
    #   - "8080:8080"
    #   - "9090:9090"
    env_file:
      - .env.tmforum-common
    networks:
      - access-node


  product-catalog:
    # Service: TMF620 - Product Catalog Management
    # Purpose: Repository for products and services.
    # Internal Ports: 8080 (API), 9090 (Admin/Metrics)
    image: docker.io/drllbl18/tmforum-product-catalog:sbx_1.5.2
    container_name: product-catalog
    restart: always
    labels:
      - "dome.name=product-catalog"
      - "dome.description=Catalog of products"
      - "dome.owner=Libelium"
      - "dome.type=service"
      - "dome.lifecycle=sandbox"
      - "dome.dependsOn=component:scorpio"
      - "dome.versions="
    # ports:
    #   - "8080:8080"
    #   - "9090:9090"
    env_file:
      - .env.tmforum-common
    networks:
      - access-node


  product-inventory:
    # Service: TMF637 - Product Inventory Management
    # Purpose: Manages the inventory of products.
    # Internal Ports: 8080 (API), 9090 (Admin/Metrics)
    image: docker.io/drllbl18/tmforum-product-inventory:sbx_1.5.2
    container_name: product-inventory
    restart: always
    labels:
      - "dome.name=product-inventory"
      - "dome.description=Manages product inventory"
      - "dome.owner=Libelium"
      - "dome.type=service"
      - "dome.lifecycle=sandbox"
      - "dome.dependsOn=component:scorpio"
      - "dome.versions="
    # ports:
    #   - "8080:8080"
    #   - "9090:9090"
    env_file:
      - .env.tmforum-common
    networks:
      - access-node


  product-ordering-management:
    # Service: TMF622 - Product Ordering Management
    # Purpose: Manages product orders.
    # Internal Ports: 8080 (API), 9090 (Admin/Metrics)
    image: docker.io/drllbl18/tmforum-product-ordering-management:sbx_1.5.2
    container_name: product-ordering-management
    restart: always
    labels:
      - "dome.name=product-ordering-management"
      - "dome.description=Manages product orders"
      - "dome.owner=Libelium"
      - "dome.type=service"
      - "dome.lifecycle=sandbox"
      - "dome.dependsOn=component:scorpio"
      - "dome.versions="
    # ports:
    #   - "8080:8080"
    #   - "9090:9090"
    env_file:
      - .env.tmforum-common
    networks:
      - access-node


  quote:
    # Service: TMF648 - Quote Management
    # Purpose: Manages product quotes.
    # Internal Ports: 8080 (API), 9090 (Admin/Metrics)
    image: docker.io/drllbl18/tmforum-quote:sbx_1.5.2
    container_name: quote
    restart: always
    labels:
      - "dome.name=quote"
      - "dome.description=Manages quotes"
      - "dome.owner=Libelium"
      - "dome.type=service"
      - "dome.lifecycle=sandbox"
      - "dome.dependsOn=component:scorpio"
      - "dome.versions="
    # ports:
    #   - "8080:8080"
    #   - "9090:9090"
    env_file:
      - .env.tmforum-common
    networks:
      - access-node


  resource-catalog:
    # Service: TMF634 - Resource Catalog Management
    # Purpose: Repository for resources.
    # Internal Ports: 8080 (API), 9090 (Admin/Metrics)
    image: docker.io/drllbl18/tmforum-resource-catalog:sbx_1.5.2
    container_name: resource-catalog
    restart: always
    labels:
      - "dome.name=resource-catalog"
      - "dome.description=Catalog of resources"
      - "dome.owner=Libelium"
      - "dome.type=service"
      - "dome.lifecycle=sandbox"
      - "dome.dependsOn=component:scorpio"
      - "dome.versions="
    # ports:
    #   - "8080:8080"
    #   - "9090:9090"
    env_file:
      - .env.tmforum-common
    networks:
      - access-node


  resource-function-activation:
    # Service: TMF664 - Resource Function Activation Management
    # Purpose: Manages resource function lifecycle.
    # Internal Ports: 8080 (API), 9090 (Admin/Metrics)
    image: docker.io/drllbl18/tmforum-resource-function-activation:sbx_1.5.2
    container_name: resource-function-activation
    restart: always
    labels:
      - "dome.name=resource-function-activation"
      - "dome.description=Manages resource functions"
      - "dome.owner=Libelium"
      - "dome.type=service"
      - "dome.lifecycle=sandbox"
      - "dome.dependsOn=component:scorpio"
      - "dome.versions="
    # ports:
    #   - "8080:8080"
    #   - "9090:9090"
    env_file:
      - .env.tmforum-common
    networks:
      - access-node


  resource-inventory:
    # Service: TMF639 - Resource Inventory Management
    # Purpose: Manages resource inventory.
    # Internal Ports: 8080 (API), 9090 (Admin/Metrics)
    image: docker.io/drllbl18/tmforum-resource-inventory:sbx_1.5.2
    container_name: resource-inventory
    restart: always
    labels:
      - "dome.name=resource-inventory"
      - "dome.description=Manages resource inventory"
      - "dome.owner=Libelium"
      - "dome.type=service"
      - "dome.lifecycle=sandbox"
      - "dome.dependsOn=component:scorpio"
      - "dome.versions="
    # ports:
    #   - "8080:8080"
    #   - "9090:9090"
    env_file:
      - .env.tmforum-common
    networks:
      - access-node


  service-catalog:
    # Service: TMF633 - Service Catalog Management
    # Purpose: Repository for service definitions.
    # Internal Ports: 8080 (API), 9090 (Admin/Metrics)
    image: docker.io/drllbl18/tmforum-service-catalog:sbx_1.5.2
    container_name: service-catalog
    restart: always
    labels:
      - "dome.name=service-catalog"
      - "dome.description=Catalog of services"
      - "dome.owner=Libelium"
      - "dome.type=service"
      - "dome.lifecycle=sandbox"
      - "dome.dependsOn=component:scorpio"
      - "dome.versions="
    # ports:
    #   - "8080:8080"
    #   - "9090:9090"
    env_file:
      - .env.tmforum-common
    networks:
      - access-node


  service-inventory:
    # Service: TMF638 - Service Inventory Management
    # Purpose: Manages service inventory.
    # Internal Ports: 8080 (API), 9090 (Admin/Metrics)
    image: docker.io/drllbl18/tmforum-service-inventory:sbx_1.5.2
    container_name: service-inventory
    restart: always
    labels:
      - "dome.name=service-inventory"
      - "dome.description=Manages service inventory"
      - "dome.owner=Libelium"
      - "dome.type=service"
      - "dome.lifecycle=sandbox"
      - "dome.dependsOn=component:scorpio"
      - "dome.versions="
    # ports:
    #   - "8080:8080"
    #   - "9090:9090"
    env_file:
      - .env.tmforum-common
    networks:
      - access-node


  usage-management:
    # Service: TMF635 - Usage Management
    # Purpose: Manages service usage records.
    # Internal Ports: 8080 (API), 9090 (Admin/Metrics)
    image: docker.io/drllbl18/tmforum-usage-management:sbx_1.5.2
    container_name: usage-management
    restart: always
    labels:
      - "dome.name=usage-management"
      - "dome.description=Manages service usage"
      - "dome.owner=Libelium"
      - "dome.type=service"
      - "dome.lifecycle=sandbox"
      - "dome.dependsOn="
      - "dome.versions="
    # ports:
    #   - "8080:8080"
    #   - "9090:9090"
    env_file:
      - .env.tmforum-common
    networks:
      - access-node


  # --- CORE & DLT ---
  # These services handle data replication and DLT synchronization.

  desmos:
    # Service: DESMOS
    # Purpose: Manages replication of data across nodes in the DOME ecosystem.
    # Internal Ports: 8080 (API)
    image: in2workspace/in2-desmos-api:v2.0.3
    container_name: desmos
    restart: always
    labels:
      - "dome.name=desmos"
      - "dome.description=Manages replication of data across nodes"
      - "dome.owner=Altia"
      - "dome.type=service"
      - "dome.lifecycle=sandbox"
      - "dome.dependsOn=component:scorpio"
      - "dome.versions=scorpio:any"
    # ports:
    #   - "8080:8080"
    env_file:
      - .env.desmos
    environment:
      EXTERNAL-ACCESS-NODES_URLS: ""
    networks:
      - access-node

  dlt-adapter-alastria:
    # Service: DLT Adapter Alastria
    # Purpose: Interface for Alastria DLT.
    # Internal Ports: 8080 (API)
    image: quay.io/digitelts/dlt-adapter:1.5.1
    container_name: dlt-adapter-alastria
    restart: always
    labels:
      - "dome.name=dlt-adapter-alastria"
      - "dome.description=Interface for Alastria DLT"
      - "dome.owner=DigitelTS"
      - "dome.type=service"
      - "dome.lifecycle=sandbox"
      - "dome.dependsOn="
      - "dome.versions="
    # ports:
    #   - "8080:8080"
    env_file:
      - .env.dlt-adapter-alastria
    networks:
      - access-node

  scorpio:
    # Service: Scorpio Broker
    # Purpose: Context Broker for NGSI-LD data.
    # Internal Ports: 9090
    image: scorpiobroker/all-in-one-runner:java-4.1.10
    container_name: scorpio
    restart: always
    labels:
      - "dome.name=scorpio"
      - "dome.description=NGSI-LD Context Broker"
      - "dome.owner=Elliot"
      - "dome.type=service"
      - "dome.lifecycle=sandbox"
      - "dome.dependsOn=PostgreSQL BBDD"
      - "dome.versions="
    # ports:
    #   - "9090:9090"
    env_file:
      - .env.scorpio
    networks:
      - access-node

  # --- API Gateway & Entry Point ---
  # This service is the SINGLE ENTRY POINT to the entire Access Node stack.
  # All external traffic MUST pass through this proxy.

  caddy:
    # Service: Caddy API Gateway
    # Purpose: Single entry point for all external traffic entering Access Node.
    # Ports: 80 (HTTP exposed), 443 (HTTPS)
    image: caddy:2-alpine
    container_name: caddy
    restart: always
    ports:
      - "80:80"
      # - "443:443"
    volumes:
      - ./Caddyfile:/etc/caddy/Caddyfile
      - caddy_data:/data
      - caddy_config:/config
    labels:
      - "dome.name=caddy"
      - "dome.description=API Gateway and Reverse Proxy for Access Node"
      - "dome.owner=Altia"
      - "dome.type=proxy"
      - "dome.lifecycle=sandbox"
      - "dome.dependsOn=component:account,component:agreement,component:customer-bill-management,component:customer-management,component:party-catalog,component:party-role,component:product-catalog,component:product-inventory,component:product-ordering-management,component:quote,component:resource-catalog,component:resource-function-activation,component:resource-inventory,component:service-catalog,component:service-inventory,component:usage-management,component:desmos"
      - "dome.versions=any"
    networks:
      - access-node

networks:
  access-node:
    name: access-node

volumes:
  caddy_data:
  caddy_config:

